{
    "label": "others",
    "workflow": [
        {
            "step": 1,
            "label": "backend",
            "introduction": "Step 1 provides a Python helper that verifies the path of an existing CosmWasm contract crate by looking for a Cargo.toml file and returns its absolute Path object.",
            "code": "from pathlib import Path\nfrom typing import Union\n\n\ndef locate_contract_crate(start_path: Union[str, Path] = '.') -> Path:\n    '''\n    Locate the root of a CosmWasm contract crate.\n\n    The function checks that a `Cargo.toml` file exists in the provided directory\n    and returns the absolute path to the crate root.\n\n    Args:\n        start_path: Directory where the search should begin. Defaults to the\n            current working directory.\n\n    Returns:\n        pathlib.Path pointing to the crate root.\n\n    Raises:\n        FileNotFoundError: If the `Cargo.toml` file cannot be found.\n    '''\n    crate_path = Path(start_path).expanduser().resolve()\n    cargo_file = crate_path / 'Cargo.toml'\n\n    if not cargo_file.exists():\n        raise FileNotFoundError(\n            f'Could not locate Cargo.toml at {cargo_file}. Please supply the correct contract crate path.'\n        )\n\n    return crate_path\n",
            "usage": "crate_root = locate_contract_crate('/absolute/or/relative/path/to/contract')"
        },
        {
            "step": 2,
            "label": "backend",
            "introduction": "Step 2 modifies Cargo.toml so that `cw-orch` is available under `[dev-dependencies]`, keeping the macro limited to testing and scripting.",
            "code": "import toml\nfrom pathlib import Path\nfrom typing import Union\n\n\ndef add_cargo_dependency(crate_path: Union[str, Path]) -> None:\n    '''\n    Add `cw-orch` to the `[dev-dependencies]` section of Cargo.toml if it is not already present.\n\n    Args:\n        crate_path: Path to the root of the contract crate.\n    '''\n    crate_path = Path(crate_path).expanduser().resolve()\n    cargo_toml = crate_path / 'Cargo.toml'\n\n    if not cargo_toml.exists():\n        raise FileNotFoundError(f'{cargo_toml} does not exist.')\n\n    cargo_data = toml.load(cargo_toml)\n    dev_deps = cargo_data.get('dev-dependencies', {})\n\n    if 'cw-orch' not in dev_deps:\n        dev_deps['cw-orch'] = {\n            'version': '^0.9',\n            'default-features': False,\n            'features': ['derive']\n        }\n        cargo_data['dev-dependencies'] = dev_deps\n        cargo_toml.write_text(toml.dumps(cargo_data))\n        print('cw-orch added to dev-dependencies.')\n    else:\n        print('cw-orch already present in dev-dependencies; skipping.')\n",
            "usage": "add_cargo_dependency(crate_root)"
        },
        {
            "step": 3,
            "label": "backend",
            "introduction": "Step 3 makes sure a fresh `src/interface.rs` file exists (or is truncated) so that the boilerplate can be inserted in the next step.",
            "code": "from pathlib import Path\nfrom typing import Union\n\n\ndef create_interface_file(crate_path: Union[str, Path]) -> Path:\n    '''\n    Create (or truncate) the `src/interface.rs` file within the contract crate.\n\n    Args:\n        crate_path: Path to the root of the contract crate.\n\n    Returns:\n        Path to the created file.\n    '''\n    crate_path = Path(crate_path).expanduser().resolve()\n    src_dir = crate_path / 'src'\n    src_dir.mkdir(parents=True, exist_ok=True)\n    interface_path = src_dir / 'interface.rs'\n    interface_path.write_text('')\n    print(f'Created empty interface file at {interface_path}')\n    return interface_path\n",
            "usage": "interface_path = create_interface_file(crate_root)"
        },
        {
            "step": 4,
            "label": "backend",
            "introduction": "Step 4 fills `src/interface.rs` with a cw-orch `#[interface]` boilerplate that links to your contract\u2019s InstantiateMsg, ExecuteMsg and QueryMsg.",
            "code": "from pathlib import Path\nfrom typing import Union\n\nINTERFACE_BOILERPLATE = '''// Auto-generated by tooling \u2014 feel free to extend.\nuse cosmwasm_std::{Addr, Response, DepsMut, Env, MessageInfo};\nuse cw_orch::interface;\n\n#[interface]\npub trait CounterContract {\n    type Error = anyhow::Error;\n    type InstantiateMsg = crate::msg::InstantiateMsg;\n    type ExecuteMsg = crate::msg::ExecuteMsg;\n    type QueryMsg = crate::msg::QueryMsg;\n\n    // (Optional) declare helper wrappers, e.g.:\n    fn increment(&self) -> Result<Response, Self::Error>;\n}\n'''\n\n\ndef write_interface_boilerplate(crate_path: Union[str, Path]) -> None:\n    '''\n    Populate `src/interface.rs` with the cw-orch interface boilerplate.\n    '''\n    crate_path = Path(crate_path).expanduser().resolve()\n    interface_file = crate_path / 'src' / 'interface.rs'\n\n    if not interface_file.exists():\n        raise FileNotFoundError(\n            f'interface.rs does not exist at {interface_file}. Did you run create_interface_file()?'\n        )\n\n    interface_file.write_text(INTERFACE_BOILERPLATE)\n    print(f'Wrote interface boilerplate to {interface_file}')\n",
            "usage": "write_interface_boilerplate(crate_root)"
        },
        {
            "step": 5,
            "label": "backend",
            "introduction": "Step 5 compiles the crate in test-mode with `cargo check --tests` to make sure the new interface and dependency build correctly.",
            "code": "import subprocess\nfrom pathlib import Path\nfrom typing import Union\n\n\ndef cargo_check(crate_path: Union[str, Path]) -> None:\n    '''\n    Run `cargo check --tests` inside the provided contract crate directory.\n    '''\n    crate_path = Path(crate_path).expanduser().resolve()\n    cmd = ['cargo', 'check', '--tests']\n\n    try:\n        subprocess.run(cmd, cwd=crate_path, check=True, text=True)\n        print('cargo check --tests completed successfully.')\n    except subprocess.CalledProcessError as error:\n        if error.stdout:\n            print(error.stdout)\n        if error.stderr:\n            print(error.stderr)\n        raise\n",
            "usage": "cargo_check(crate_root)"
        }
    ]
}
{
    "label": "query_contract",
    "workflow": [
        {
            "step": 1,
            "label": "frontend",
            "introduction": "Prompts the user for a CosmWasm contract address and performs minimal validation.",
            "code": "export const requestContractAddress = () => {\n  // Prompt the user; in a real UI this could be a form field instead\n  const contractAddress = prompt('Enter the CosmWasm contract address to query:');\n\n  // Very basic validation (prefix + length)\n  if (!contractAddress || contractAddress.trim().length < 40) {\n    throw new Error('Invalid contract address provided.');\n  }\n\n  return contractAddress.trim();\n};",
            "usage": "const address = requestContractAddress();"
        },
        {
            "step": 2,
            "label": "frontend",
            "introduction": "Creates the JSON payload required for the `get_count` smart-query.",
            "code": "export const constructGetCountQuery = () => {\n  // According to the contract schema, `get_count` takes no parameters\n  const queryPayload = {\n    get_count: {}\n  };\n\n  return queryPayload; // Pass this object to the backend as JSON.\n};",
            "usage": "const queryPayload = constructGetCountQuery();"
        },
        {
            "step": 3,
            "label": "backend",
            "introduction": "Provides a FastAPI endpoint that base64-encodes the query, hits the chain\u2019s REST API, and returns the result.",
            "code": "from fastapi import FastAPI, HTTPException\nfrom fastapi.responses import JSONResponse\nimport aiohttp\nimport base64\nimport json\n\napp = FastAPI()\n\n@app.get('/api/query_count')\nasync def query_count(contract_address: str, rpc_endpoint: str = 'https://rpc.cosmos.directory/juno'):\n    \"\"\"\n    Perform a CosmWasm smart-query (`get_count`) against the specified contract.\n\n    Args:\n        contract_address: The bech32 address of the contract.\n        rpc_endpoint:   Base URL of a publicly accessible gRPC-gateway or LCD endpoint.\n    \"\"\"\n    try:\n        # 1. Build and encode the query\n        query_dict = {\"get_count\": {}}\n        encoded_query = base64.b64encode(json.dumps(query_dict).encode()).decode()\n\n        # 2. Compose the REST path defined by Cosmos SDK <v0.46+>/CosmWasm\n        #    Format: /cosmwasm/wasm/v1/contract/{address}/smart/{b64_encoded_query}\n        url = f\"{rpc_endpoint}/cosmwasm/wasm/v1/contract/{contract_address}/smart/{encoded_query}\"\n\n        # 3. Execute HTTP GET\n        async with aiohttp.ClientSession() as session:\n            async with session.get(url, timeout=10) as resp:\n                if resp.status != 200:\n                    error_text = await resp.text()\n                    raise HTTPException(status_code=resp.status,\n                                        detail=f'Upstream error: {error_text}')\n                data = await resp.json()\n                return JSONResponse(content=data)\n\n    except Exception as e:\n        # Surface any unexpected errors\n        raise HTTPException(status_code=500, detail=str(e))",
            "usage": "/* Frontend call example */\nconst rpc = 'https://rpc.cosmos.directory/juno';\nconst res = await fetch(`/api/query_count?contract_address=${address}&rpc_endpoint=${encodeURIComponent(rpc)}`);\nconst { data } = await res.json();\nconsole.log('Counter value:', data);"
        }
    ]
}
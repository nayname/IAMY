{
    "label": "others",
    "workflow": [
        {
            "step": 1,
            "label": "backend",
            "introduction": "This backend Python function checks whether Docker is installed and the daemon is responsive by running `docker version`.",
            "code": "import subprocess\nfrom typing import Dict\n\n\ndef verify_docker_installed() -> Dict[str, str]:\n    '''Verify that Docker is installed and the daemon is responding by running `docker version`.'''\n    try:\n        completed = subprocess.run(\n            ['docker', 'version'],\n            check=True,\n            stdout=subprocess.PIPE,\n            stderr=subprocess.PIPE,\n            text=True,\n        )\n    except FileNotFoundError as exc:\n        raise RuntimeError(\n            'Docker is not installed or not available in PATH. '\n            'Install Docker Desktop (on macOS/Apple Silicon) or Docker Engine, then try again.'\n        ) from exc\n    except subprocess.CalledProcessError as exc:\n        raise RuntimeError(\n            'Docker is installed but the daemon may not be running or is misconfigured.\\n'\n            f'Stdout:\\n{exc.stdout}\\nStderr:\\n{exc.stderr}'\n        ) from exc\n\n    return {\n        'status': 'ok',\n        'message': 'Docker is installed and responding.',\n        'stdout': completed.stdout,\n    }\n",
            "usage": "try:\n    info = verify_docker_installed()\n    print(info['message'])\nexcept RuntimeError as err:\n    # Instruct the user to install or start Docker based on the error message\n    print(str(err))"
        },
        {
            "step": 2,
            "label": "backend",
            "introduction": "This backend Python function runs `cargo check` in the contract project root to ensure the Rust contract compiles before optimization.",
            "code": "import subprocess\nfrom pathlib import Path\nfrom typing import Dict, Any\n\n\ndef verify_contract_builds_locally(project_root: str) -> Dict[str, Any]:\n    '''Run `cargo check` in the given project root to ensure the Rust contract compiles locally.'''\n    root = Path(project_root).expanduser().resolve()\n    cargo_toml = root / 'Cargo.toml'\n    if not cargo_toml.is_file():\n        raise FileNotFoundError(f'No Cargo.toml found in {root}; ensure project_root is the contract root directory.')\n\n    try:\n        completed = subprocess.run(\n            ['cargo', 'check'],\n            cwd=str(root),\n            check=True,\n            stdout=subprocess.PIPE,\n            stderr=subprocess.PIPE,\n            text=True,\n        )\n    except FileNotFoundError as exc:\n        raise RuntimeError('Cargo is not installed or not available in PATH. Install Rust and Cargo from https://rustup.rs/.') from exc\n    except subprocess.CalledProcessError as exc:\n        raise RuntimeError(\n            'cargo check failed. Fix the compilation errors before running the optimizer.\\n'\n            f'Stdout:\\n{exc.stdout}\\nStderr:\\n{exc.stderr}'\n        ) from exc\n\n    return {\n        'status': 'ok',\n        'message': 'cargo check completed successfully.',\n        'stdout': completed.stdout,\n    }\n",
            "usage": "project_root = '/path/to/your/contract/root'\n\ntry:\n    result = verify_contract_builds_locently(project_root)\n    print(result['message'])\nexcept RuntimeError as err:\n    # Show compilation errors to the user and stop the pipeline\n    print(str(err))"
        },
        {
            "step": 3,
            "label": "backend",
            "introduction": "This backend Python function runs the `cosmwasm/rust-optimizer-arm64` Docker image against the contract root to produce optimized .wasm artifacts.",
            "code": "import subprocess\nfrom pathlib import Path\nfrom typing import Dict, Any\n\n\ndef run_rust_optimizer_arm64(project_root: str, tag: str = 'latest') -> Dict[str, Any]:\n    '''Run the cosmwasm/rust-optimizer-arm64 Docker image against the given contract root directory.'''\n    root = Path(project_root).expanduser().resolve()\n    if not (root / 'Cargo.toml').is_file():\n        raise FileNotFoundError(f'No Cargo.toml found in {root}; ensure project_root is the contract root directory.')\n\n    cache_volume = f'{root.name}_cache'\n    image = f'cosmwasm/rust-optimizer-arm64:{tag}'\n\n    cmd = [\n        'docker', 'run', '--rm',\n        '-v', f'{root}:/code',\n        '--mount', f'type=volume,source={cache_volume},target=/code/target',\n        image,\n    ]\n\n    try:\n        completed = subprocess.run(\n            cmd,\n            check=True,\n            stdout=subprocess.PIPE,\n            stderr=subprocess.PIPE,\n            text=True,\n        )\n    except FileNotFoundError as exc:\n        raise RuntimeError('Docker is not installed or not available in PATH. Install Docker and try again.') from exc\n    except subprocess.CalledProcessError as exc:\n        raise RuntimeError(\n            'rust-optimizer Docker run failed.\\n'\n            f'Stdout:\\n{exc.stdout}\\nStderr:\\n{exc.stderr}'\n        ) from exc\n\n    return {\n        'status': 'ok',\n        'message': f'Optimization completed using image {image}.',\n        'stdout': completed.stdout,\n    }\n",
            "usage": "project_root = '/path/to/your/contract/root'\n\ntry:\n    info = run_rust_optimizer_arm64(project_root, tag='latest')\n    print(info['message'])\nexcept RuntimeError as err:\n    # Surface optimizer or Docker errors to the user\n    print(str(err))"
        },
        {
            "step": 4,
            "label": "backend",
            "introduction": "This backend Python function inspects the ./artifacts directory under the project root and returns the list of generated optimized .wasm files.",
            "code": "from pathlib import Path\nfrom typing import List\n\n\ndef collect_optimized_wasm_artifacts(project_root: str) -> List[str]:\n    '''List optimized .wasm files from the ./artifacts directory in the given project root.'''\n    root = Path(project_root).expanduser().resolve()\n    artifacts_dir = root / 'artifacts'\n\n    if not artifacts_dir.is_dir():\n        raise FileNotFoundError(f'Artifacts directory not found at {artifacts_dir}. Have you run the rust-optimizer?')\n\n    wasm_files = sorted(str(p) for p in artifacts_dir.glob('*.wasm'))\n    if not wasm_files:\n        raise RuntimeError(f'No .wasm files found in {artifacts_dir}. Ensure the optimizer completed successfully.')\n\n    return wasm_files\n",
            "usage": "project_root = '/path/to/your/contract/root'\n\ntry:\n    wasm_paths = collect_optimized_wasm_artifacts(project_root)\n    for path in wasm_paths:\n        print(path)\nexcept (FileNotFoundError, RuntimeError) as err:\n    # Inform the user that artifacts are missing or the optimizer has not been run\n    print(str(err))"
        }
    ]
}
{
    "label": "others",
    "workflow": [
        {
            "step": 1,
            "label": "backend",
            "introduction": "Step 1 provides a small Python utility that shells out to Docker and runs the CosmWasm workspace-optimizer to build size-optimized `.wasm` binaries for every contract in your Cargo workspace.",
            "code": "import subprocess\nimport os\nimport sys\n\n\ndef run_workspace_optimizer(repo_root: str = \".\") -> None:\n    \"\"\"\n    Run the CosmWasm workspace-optimizer Docker image to compile optimized\n    Wasm binaries for every smart contract found in the Cargo workspace.\n\n    Args:\n        repo_root: Path to the repository root (defaults to current dir).\n    Raises:\n        FileNotFoundError: If Docker is not installed.\n        subprocess.CalledProcessError: If the Docker command exits non-zero.\n    \"\"\"\n    cmd = [\n        \"docker\",\n        \"run\",\n        \"--rm\",\n        \"-it\",\n        \"-v\",\n        f\"{os.path.abspath(repo_root)}:/code\",\n        \"--mount\",\n        \"type=volume,source=registry_cache,target=/usr/local/cargo/registry\",\n        \"cosmwasm/workspace-optimizer:0.12.11\",\n    ]\n\n    try:\n        subprocess.run(cmd, check=True)\n        print(\"\u2705  Workspace optimizer completed successfully.\")\n    except FileNotFoundError:\n        print(\"\ud83d\uded1  Docker is not installed or could not be found in $PATH.\", file=sys.stderr)\n        raise\n    except subprocess.CalledProcessError as e:\n        print(f\"\ud83d\uded1  Workspace optimizer failed with exit code {e.returncode}.\", file=sys.stderr)\n        raise\n\n\nif __name__ == \"__main__\":\n    # Allow CLI execution: `python run_workspace_optimizer.py` from repo root\n    run_workspace_optimizer()\n",
            "usage": "From your repository root, run the optimizer with:\n\n```bash\npython run_workspace_optimizer.py\n```"
        },
        {
            "step": 2,
            "label": "backend",
            "introduction": "Step 2 supplies a Python script that validates the optimizer\u2019s output by ensuring an optimized `.wasm` file exists in `./artifacts` for every member declared in your Cargo workspace.",
            "code": "import os\nimport sys\nimport glob\nfrom typing import List\n\ntry:\n    import toml  # Light-weight parser for Cargo.toml\nexcept ImportError:\n    print(\"The 'toml' package is required. Install it with `pip install toml`.\", file=sys.stderr)\n    raise\n\n\ndef _get_workspace_members(repo_root: str = \".\") -> List[str]:\n    \"\"\"Return the list of workspace member directories from Cargo.toml.\"\"\"\n    cargo_path = os.path.join(repo_root, \"Cargo.toml\")\n    if not os.path.exists(cargo_path):\n        raise FileNotFoundError(\"Cargo.toml not found at repository root.\")\n    data = toml.load(cargo_path)\n    return data.get(\"workspace\", {}).get(\"members\", [])\n\n\ndef verify_workspace_artifacts(repo_root: str = \".\") -> None:\n    \"\"\"\n    Ensure that `artifacts/` contains one optimized `.wasm` file for every\n    contract in the workspace.\n    \"\"\"\n    members = _get_workspace_members(repo_root)\n    artifact_dir = os.path.join(repo_root, \"artifacts\")\n\n    if not os.path.isdir(artifact_dir):\n        raise FileNotFoundError(\"artifacts/ directory not found. Did you run the optimizer?\")\n\n    wasm_files = glob.glob(os.path.join(artifact_dir, \"*.wasm\"))\n    wasm_basenames = {os.path.splitext(os.path.basename(p))[0] for p in wasm_files}\n\n    missing_contracts = []\n    for member in members:\n        contract_name = os.path.basename(member)\n        if contract_name not in wasm_basenames:\n            missing_contracts.append(contract_name)\n\n    if missing_contracts:\n        raise RuntimeError(\n            \"Missing optimized contracts: \" + \", \".join(missing_contracts)\n        )\n\n    print(\"\u2705  All workspace contracts have corresponding optimized Wasm artifacts.\")\n\n\nif __name__ == \"__main__\":\n    # Allow CLI execution: `python verify_workspace_artifacts.py`\n    verify_workspace_artifacts()\n",
            "usage": "After running the optimizer, validate the output with:\n\n```bash\npython verify_workspace_artifacts.py\n```"
        }
    ]
}
{
    "label": "others",
    "workflow": [
        {
            "step": 1,
            "label": "frontend",
            "introduction": "Step 1 provides a small, wallet-agnostic browser helper that prompts the user for (a) a UNIX timestamp or RFC-3339 string and (b) the RPC endpoint URL of the target chain, then normalises the timestamp to seconds since Unix epoch.",
            "code": "/* -------------------------------------------------------------\n * promptUserForBlockSearch()\n * Prompts for timestamp & RPC URL, validates the inputs and\n * returns them in a normalised shape that the backend expects.\n * No external libraries are required, fully browser-native.\n * -----------------------------------------------------------*/\nexport const promptUserForBlockSearch = async () => {\n  // Ask for a timestamp (UNIX seconds or RFC-3339 date-time string)\n  const tsRaw = window.prompt(\n    'Enter a UNIX timestamp (seconds) or an RFC-3339 date/time string:',\n    ''\n  );\n  if (!tsRaw) {\n    throw new Error('A timestamp value is required.');\n  }\n\n  // Ask for the RPC endpoint URL (e.g. https://rpc-evmos.example)\n  const rpcUrl = window.prompt('Enter the RPC endpoint URL for the chain:', '');\n  if (!rpcUrl) {\n    throw new Error('An RPC URL is required.');\n  }\n\n  // Helper: convert a string that might be RFC-3339 into a UNIX timestamp\n  const normaliseTimestamp = (input) => {\n    // If it is only digits, treat as UNIX seconds already\n    if (/^\\d+$/.test(input.trim())) {\n      return parseInt(input.trim(), 10);\n    }\n    // Otherwise attempt RFC-3339/ISO-8601 parse using Date()\n    const d = new Date(input);\n    if (isNaN(d.getTime())) {\n      throw new Error('Invalid RFC-3339/ISO-8601 date-time string provided.');\n    }\n    return Math.floor(d.getTime() / 1000); // seconds\n  };\n\n  const timestamp = normaliseTimestamp(tsRaw);\n  return { timestamp, rpcUrl: rpcUrl.trim() };\n};",
            "usage": "const { timestamp, rpcUrl } = await promptUserForBlockSearch();"
        },
        {
            "step": 2,
            "label": "backend",
            "introduction": "Step 2 exposes a FastAPI endpoint that shells out to Foundry\u2019s `cast` CLI to find the block nearest to the supplied timestamp on the provided RPC endpoint. The endpoint performs strong validation and error handling.",
            "code": "from fastapi import FastAPI, HTTPException\nfrom fastapi.responses import JSONResponse\nfrom subprocess import run, CalledProcessError\nimport shutil\nimport re\n\napp = FastAPI()\n\n# Utility: verify that the cast binary exists on the host\nif shutil.which('cast') is None:\n    raise RuntimeError(\"'cast' CLI not found on host. Please install Foundry\");\n\n@app.get('/api/find-block')\nasync def find_block(timestamp: int, rpc_url: str):\n    \"\"\"Return the block number closest to a given Unix timestamp.\"\"\"\n\n    # Basic sanity-checks -----------------------------------------------------\n    if timestamp <= 0:\n        raise HTTPException(status_code=400, detail='Timestamp must be > 0')\n    if not re.match(r'^https?://', rpc_url):\n        raise HTTPException(status_code=400, detail='rpc_url must start with http(s)://')\n\n    # Build the cast command --------------------------------------------------\n    cmd = [\n        'cast', 'find-block',\n        '--timestamp', str(timestamp),\n        '--rpc-url', rpc_url.strip()\n    ]\n\n    try:\n        # Run the process with a 10-second safety timeout\n        proc = run(cmd, capture_output=True, text=True, check=True, timeout=10)\n        block_no_str = proc.stdout.strip()\n\n        # cast normally returns a decimal block number, but guard against hex\n        try:\n            block_no = int(block_no_str, 0)\n        except ValueError:\n            block_no = block_no_str  # keep as string if it cannot be parsed\n\n        return JSONResponse({\n            'timestamp': timestamp,\n            'rpc_url': rpc_url,\n            'block_number': block_no\n        })\n\n    except CalledProcessError as e:\n        # CLI returned non-zero exit status\n        raise HTTPException(status_code=500, detail=f\"cast error: {e.stderr.strip()}\")\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=str(e))",
            "usage": "GET /api/find-block?timestamp=<unix_seconds>&rpc_url=<encoded_url>\nExample (JavaScript):\nconst res = await fetch(`/api/find-block?timestamp=${timestamp}&rpc_url=${encodeURIComponent(rpcUrl)}`);\nconst data = await res.json();\nconsole.log('Nearest block number:', data.block_number);"
        }
    ]
}
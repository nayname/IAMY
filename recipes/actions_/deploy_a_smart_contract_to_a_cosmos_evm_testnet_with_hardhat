{
    "label": "upload",
    "workflow": [
        {
            "step": 1,
            "label": "backend",
            "introduction": "Bootstrap a brand-new Hardhat project on the server. This endpoint creates the folder, runs `npm init -y`, installs Hardhat, and scaffolds the default Hardhat workspace.",
            "code": "from fastapi import APIRouter, HTTPException\nimport subprocess, os\n\nrouter = APIRouter()\n\n@router.post('/api/hardhat/init')\nasync def init_hardhat_project(project_name: str):\n    \"\"\"Initialize a Hardhat project inside a server-side working directory.\"\"\"\n    try:\n        project_path = os.path.abspath(project_name)\n        if os.path.exists(project_path):\n            raise HTTPException(status_code=400, detail='Directory already exists')\n        os.makedirs(project_path, exist_ok=True)\n\n        # 1. Generate package.json\n        subprocess.run(['npm', 'init', '-y'], cwd=project_path, check=True)\n\n        # 2. Install Hardhat locally\n        subprocess.run(['npm', 'install', '--save-dev', 'hardhat'], cwd=project_path, check=True)\n\n        # 3. Scaffold Hardhat boilerplate (\u2013yes answers all prompts)\n        subprocess.run(['npx', 'hardhat', '--yes'], cwd=project_path, check=True)\n\n        return {\"status\": \"success\", \"project_path\": project_path}\n    except subprocess.CalledProcessError as e:\n        raise HTTPException(status_code=500, detail=f'Command failed: {e}')",
            "usage": "await fetch('/api/hardhat/init', {method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({project_name: 'my-evmos-dapp'})});"
        },
        {
            "step": 2,
            "label": "backend",
            "introduction": "Install Solidity compiler helpers, Hardhat Toolbox, and the Cosmos-EVM plugin your chain needs.",
            "code": "from fastapi import APIRouter, HTTPException\nimport subprocess, os\n\nrouter = APIRouter()\n\n@router.post('/api/hardhat/install-deps')\nasync def install_solidity_dependencies(project_path: str):\n    \"\"\"Add @nomicfoundation/hardhat-toolbox and @evmos/hardhat-evmos to the project.\"\"\"\n    try:\n        if not os.path.isdir(project_path):\n            raise HTTPException(status_code=404, detail='Project directory not found')\n        packages = ['@nomicfoundation/hardhat-toolbox', '@evmos/hardhat-evmos']\n        subprocess.run(['npm', 'install', '--save-dev', *packages], cwd=project_path, check=True)\n        return {\"status\": \"success\", \"installed\": packages}\n    except subprocess.CalledProcessError as e:\n        raise HTTPException(status_code=500, detail=f'Install failed: {e}')",
            "usage": "await fetch('/api/hardhat/install-deps', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({project_path: '/absolute/path/to/my-evmos-dapp'})});"
        },
        {
            "step": 3,
            "label": "backend",
            "introduction": "Programmatically patch `hardhat.config.js` so Hardhat knows about your Cosmos testnet RPC, chainId, gas price, and deployer key.",
            "code": "from fastapi import APIRouter, HTTPException\nimport os, json\n\nrouter = APIRouter()\n\nNETWORK_TEMPLATE = \"\"\"\nrequire('@nomicfoundation/hardhat-toolbox');\nrequire('@evmos/hardhat-evmos');\n\nmodule.exports = {\n  solidity: '0.8.19',\n  networks: {\n    {network_name}: {\n      url: '{rpc_url}',\n      chainId: {chain_id},\n      gasPrice: '{gas_price}',\n      accounts: ['{private_key}']\n    }\n  }\n};\n\"\"\"\n\n@router.post('/api/hardhat/config-network')\nasync def configure_hardhat_network(project_path: str, network_name: str, rpc_url: str, chain_id: int, gas_price: str, private_key: str):\n    \"\"\"Write or overwrite hardhat.config.js with network values sent from the client side.\"\"\"\n    try:\n        if not os.path.isdir(project_path):\n            raise HTTPException(status_code=404, detail='Project directory not found')\n        config_path = os.path.join(project_path, 'hardhat.config.js')\n        with open(config_path, 'w', encoding='utf-8') as fh:\n            fh.write(NETWORK_TEMPLATE.format(\n                network_name=network_name,\n                rpc_url=rpc_url,\n                chain_id=chain_id,\n                gas_price=gas_price,\n                private_key=private_key\n            ))\n        return {\"status\": \"success\", \"config_path\": config_path}\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=str(e))",
            "usage": "await fetch('/api/hardhat/config-network', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({project_path:'/absolute/path/to/my-evmos-dapp', network_name:'evmosTestnet', rpc_url:'https://rpc.evmos-testnet.io', chain_id:9000, gas_price:'5000000000wei', private_key:'0xYOUR_PRIVATE_KEY'})});"
        },
        {
            "step": 4,
            "label": "backend",
            "introduction": "Compile every Solidity contract and generate type artifacts by calling Hardhat from Python.",
            "code": "from fastapi import APIRouter, HTTPException\nimport subprocess, os\n\nrouter = APIRouter()\n\n@router.post('/api/hardhat/compile')\nasync def hardhat_compile(project_path: str):\n    \"\"\"Run `npx hardhat compile` inside the project directory.\"\"\"\n    try:\n        if not os.path.isdir(project_path):\n            raise HTTPException(status_code=404, detail='Project directory not found')\n        subprocess.run(['npx', 'hardhat', 'compile'], cwd=project_path, check=True)\n        return {\"status\": \"success\", \"message\": \"Compilation finished\"}\n    except subprocess.CalledProcessError as e:\n        raise HTTPException(status_code=500, detail=f'Compile failed: {e}')",
            "usage": "await fetch('/api/hardhat/compile', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({project_path:'/absolute/path/to/my-evmos-dapp'})});"
        },
        {
            "step": 5,
            "label": "backend",
            "introduction": "Generate a deployment helper (`scripts/deploy.js`) that uses Hardhat\u2019s ethers helpers to deploy the compiled contract.",
            "code": "from fastapi import APIRouter, HTTPException\nimport os, textwrap\n\nrouter = APIRouter()\n\nDEPLOY_TEMPLATE = textwrap.dedent(\"\"\"\n  const hre = require('hardhat');\n\n  async function main() {\n    const ContractFactory = await hre.ethers.getContractFactory('{contract_name}');\n    const contract = await ContractFactory.deploy({constructor_args});\n    await contract.deployed();\n    console.log('Contract deployed to:', contract.address);\n  }\n\n  main()\n    .then(() => process.exit(0))\n    .catch((error) => {\n      console.error(error);\n      process.exit(1);\n    });\n\"\"\")\n\n@router.post('/api/hardhat/create-deploy-script')\nasync def create_deployment_script(project_path: str, contract_name: str, constructor_args: str = ''):\n    \"\"\"Create `scripts/deploy.js` with the supplied contract name and constructor args.\"\"\"\n    try:\n        if not os.path.isdir(project_path):\n            raise HTTPException(status_code=404, detail='Project directory not found')\n        scripts_dir = os.path.join(project_path, 'scripts')\n        os.makedirs(scripts_dir, exist_ok=True)\n        deploy_script_path = os.path.join(scripts_dir, 'deploy.js')\n        with open(deploy_script_path, 'w', encoding='utf-8') as fh:\n            fh.write(DEPLOY_TEMPLATE.format(contract_name=contract_name, constructor_args=constructor_args))\n        return {\"status\": \"success\", \"deploy_script\": deploy_script_path}\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=str(e))",
            "usage": "await fetch('/api/hardhat/create-deploy-script', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({project_path:'/absolute/path/to/my-evmos-dapp', contract_name:'MyToken', constructor_args:\"'My Token', 'MTK'\"})});"
        },
        {
            "step": 6,
            "label": "backend",
            "introduction": "Run the deployment script on the designated Cosmos testnet network and return the resulting contract address.",
            "code": "from fastapi import APIRouter, HTTPException\nimport subprocess, os, re\n\nrouter = APIRouter()\n\nDEPLOY_REGEX = re.compile(r'Contract deployed to:\\s*(0x[0-9a-fA-F]{40})')\n\n@router.post('/api/hardhat/deploy')\nasync def hardhat_run_deployment(project_path: str, network_name: str):\n    \"\"\"Execute `npx hardhat run scripts/deploy.js --network <network>` and parse stdout for contract address.\"\"\"\n    try:\n        if not os.path.isdir(project_path):\n            raise HTTPException(status_code=404, detail='Project directory not found')\n        completed = subprocess.run(['npx', 'hardhat', 'run', 'scripts/deploy.js', '--network', network_name], cwd=project_path, check=True, capture_output=True, text=True)\n        match = DEPLOY_REGEX.search(completed.stdout)\n        address = match.group(1) if match else None\n        return {\"status\": \"success\", \"stdout\": completed.stdout, \"contract_address\": address}\n    except subprocess.CalledProcessError as e:\n        raise HTTPException(status_code=500, detail=f'Deployment failed: {e}\\n{e.stdout}\\n{e.stderr}')",
            "usage": "await fetch('/api/hardhat/deploy', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({project_path:'/absolute/path/to/my-evmos-dapp', network_name:'evmosTestnet'})});"
        },
        {
            "step": 7,
            "label": "backend",
            "introduction": "Optionally verify the deployed contract on a supported block-explorer using Hardhat\u2019s verify task.",
            "code": "from fastapi import APIRouter, HTTPException\nimport subprocess, os\n\nrouter = APIRouter()\n\n@router.post('/api/hardhat/verify')\nasync def hardhat_verify_contract(project_path: str, network_name: str, contract_address: str, constructor_args: str = ''):\n    \"\"\"Invoke `npx hardhat verify` with the given parameters.\"\"\"\n    try:\n        if not os.path.isdir(project_path):\n            raise HTTPException(status_code=404, detail='Project directory not found')\n        cmd = ['npx', 'hardhat', 'verify', '--network', network_name, contract_address]\n        if constructor_args:\n            cmd.extend(constructor_args.split())\n        subprocess.run(cmd, cwd=project_path, check=True)\n        return {\"status\": \"success\", \"verified\": contract_address}\n    except subprocess.CalledProcessError as e:\n        raise HTTPException(status_code=500, detail=f'Verification failed: {e}')",
            "usage": "await fetch('/api/hardhat/verify', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({project_path:'/absolute/path/to/my-evmos-dapp', network_name:'evmosTestnet', contract_address:'0x1234...ABCD', constructor_args:\"'My Token' 'MTK'\"})});"
        }
    ]
}
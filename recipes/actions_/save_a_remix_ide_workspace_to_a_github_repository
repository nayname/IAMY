{
    "label": "others",
    "workflow": [
        {
            "step": 1,
            "label": "frontend",
            "introduction": "Activate the built-in GitHub plugin inside Remix so that the user can access version-control features from the IDE.",
            "code": "export const activateRemixGithubPlugin = async () => {\n  // Ensure we are running inside the Remix IDE\n  if (!window.remix || typeof window.remix.call !== 'function') {\n    throw new Error('Remix plugin API not detected. Are you running this code inside the Remix IDE?');\n  }\n\n  try {\n    // Ask the Remix Plugin Manager to enable the GitHub plugin\n    await window.remix.call('pluginManager', 'activatePlugin', 'github');\n    return true;\n  } catch (error) {\n    console.error('Failed to activate the GitHub plugin:', error);\n    throw error;\n  }\n};",
            "usage": "await activateRemixGithubPlugin(); // returns true when the plugin is ready"
        },
        {
            "step": 2,
            "label": "backend",
            "introduction": "Provide two FastAPI endpoints that perform GitHub OAuth: one to redirect the user to GitHub (login) and another to handle the callback and return an access token.",
            "code": "from fastapi import FastAPI, HTTPException\nfrom fastapi.responses import RedirectResponse, JSONResponse\nimport httpx, os, secrets\n\napp = FastAPI()\n\n# Load your GitHub OAuth app credentials from environment variables\nGITHUB_CLIENT_ID = os.getenv('GITHUB_CLIENT_ID')\nGITHUB_CLIENT_SECRET = os.getenv('GITHUB_CLIENT_SECRET')\n\n# Very simple in-memory state store (replace with a DB or session store in production)\n_state_store = {}\n\n@app.get('/api/github/login')\nasync def github_login():\n    \"\"\"Redirect the browser to GitHub\u2019s OAuth consent page.\"\"\"\n    if not GITHUB_CLIENT_ID:\n        raise HTTPException(500, 'GITHUB_CLIENT_ID is missing.')\n\n    state = secrets.token_hex(16)\n    _state_store[state] = True  # Prevent CSRF\n\n    auth_url = (\n        'https://github.com/login/oauth/authorize'\n        f'?client_id={GITHUB_CLIENT_ID}'\n        '&scope=repo'\n        f'&state={state}'\n    )\n    return RedirectResponse(auth_url)\n\n@app.get('/api/github/callback')\nasync def github_callback(code: str, state: str):\n    \"\"\"Exchange the temporary code for a permanent GitHub access token.\"\"\"\n    if state not in _state_store:\n        raise HTTPException(400, 'Invalid OAuth state.')\n    _state_store.pop(state, None)\n\n    if not GITHUB_CLIENT_SECRET:\n        raise HTTPException(500, 'GITHUB_CLIENT_SECRET is missing.')\n\n    async with httpx.AsyncClient() as client:\n        token_resp = await client.post(\n            'https://github.com/login/oauth/access_token',\n            headers={\n                'Accept': 'application/json'\n            },\n            data={\n                'client_id': GITHUB_CLIENT_ID,\n                'client_secret': GITHUB_CLIENT_SECRET,\n                'code': code,\n                'state': state,\n            }\n        )\n        token_resp.raise_for_status()\n        token_json = token_resp.json()\n\n    access_token = token_json.get('access_token')\n    if not access_token:\n        raise HTTPException(400, 'GitHub did not return an access token.')\n\n    # In production you would typically set a secure session cookie here.\n    return JSONResponse({'access_token': access_token})",
            "usage": "1) Browser navigates to /api/github/login \u2192 user authorizes \u2192 GitHub redirects to /api/github/callback. 2) The callback returns JSON like { \"access_token\": \"gho_***\" } which the frontend should store for later API calls."
        },
        {
            "step": 3,
            "label": "backend",
            "introduction": "Accept a list of files from the Remix workspace and push them to the chosen (or newly-created) GitHub repository as an initial commit.",
            "code": "from fastapi import FastAPI, Body, HTTPException\nfrom typing import Dict\nimport httpx, base64\n\napp = FastAPI()\n\n@app.post('/api/github/push')\nasync def github_push(\n    access_token: str = Body(..., embed=True),\n    repo_name: str = Body(..., embed=True),\n    commit_message: str = Body(..., embed=True),\n    files: Dict[str, str] = Body(..., description='Mapping: filepath \u2192 file contents (utf-8 strings)')\n):\n    \"\"\"Create the repository (if needed) and push the provided files as a single commit.\"\"\"\n\n    headers = {\n        'Authorization': f'token {access_token}',\n        'Accept': 'application/vnd.github.v3+json'\n    }\n\n    async with httpx.AsyncClient(headers=headers) as client:\n        # 1\ufe0f\u20e3  Get the authenticated user\u2019s login name\n        user_resp = await client.get('https://api.github.com/user')\n        user_resp.raise_for_status()\n        owner = user_resp.json()['login']\n\n        # 2\ufe0f\u20e3  Ensure the repository exists (create it if it does not)\n        repo_resp = await client.get(f'https://api.github.com/repos/{owner}/{repo_name}')\n        if repo_resp.status_code == 404:\n            create_resp = await client.post('https://api.github.com/user/repos', json={'name': repo_name})\n            create_resp.raise_for_status()\n        elif repo_resp.status_code != 200:\n            raise HTTPException(repo_resp.status_code, f'GitHub error: {repo_resp.text}')\n\n        # 3\ufe0f\u20e3  Upload each file via the \"contents\" API\n        for path, content in files.items():\n            encoded = base64.b64encode(content.encode()).decode()\n            put_resp = await client.put(\n                f'https://api.github.com/repos/{owner}/{repo_name}/contents/{path}',\n                json={\n                    'message': commit_message,\n                    'content': encoded\n                }\n            )\n            if put_resp.status_code not in (200, 201):\n                raise HTTPException(put_resp.status_code, f'GitHub error: {put_resp.text}')\n\n    return {\n        'status': 'success',\n        'repository_url': f'https://github.com/{owner}/{repo_name}'\n    }",
            "usage": "await fetch('/api/github/push', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({\n    access_token: '<OAuth token from step 2>',\n    repo_name: 'my-remix-project',\n    commit_message: 'Initial commit from Remix',\n    files: {\n      'README.md': '# Hello Remix',\n      'contracts/MyContract.sol': '// solidity source here'\n    }\n  })\n});"
        }
    ]
}